<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rank My Kicks - Running Shoe Tier List</title>
    <!-- Tailwind CSS (Using CDN for prototyping - ignore console warnings about production) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .tier-row::-webkit-scrollbar {
            height: 8px;
        }
        .tier-row::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }
        .tier-row::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .tier-row::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Tier Label Colors - kept the same for contrast, but text color might need ensuring */
        .bg-tier-s { background-color: #ff7f7f; color: #4a0000; }
        .bg-tier-a { background-color: #ffbf7f; color: #5c2b00; }
        .bg-tier-b { background-color: #ffdf7f; color: #5c4d00; }
        .bg-tier-c { background-color: #ffff7f; color: #4d4d00; }
        .bg-tier-d { background-color: #bfff7f; color: #1a4d00; }
        .bg-tier-f { background-color: #ff7fff; color: #4d004d; }
        .bg-tier-unknown { background-color: #334155; color: #94a3b8; } /* Darker slate for unknown in dark mode */

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-shadow:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Loading Spinner */
        .loader {
            border: 4px solid #334155;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 font-sans min-h-screen flex flex-col">

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 translate-y-20 opacity-0 z-50 flex items-center gap-2">
        <i data-lucide="check-circle" class="w-4 h-4"></i>
        <span>Link copied to clipboard!</span>
    </div>

    <!-- Navbar -->
    <nav class="bg-slate-900 border-b border-slate-800 text-white shadow-lg sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- clickable logo/title -->
                <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;" class="flex items-center gap-2 hover:opacity-80 transition">
                    <i data-lucide="footprints" class="text-emerald-400 h-8 w-8"></i>
                    <span class="font-bold text-xl tracking-tight">Rank My Kicks</span>
                </a>
                <div class="hidden md:block">
                    <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-800">Home</a>
                    <a href="#" onclick="openAboutModal()" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-800">About</a>
                    <a href="mailto:nick@ridpath.com" class="px-3 py-2 rounded-md text-sm font-medium bg-emerald-600 hover:bg-emerald-700 transition">Contact</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header & Search -->
    <header class="bg-slate-900 border-b border-slate-800 py-8 px-4">
        <div class="max-w-4xl mx-auto text-center space-y-4">
            <h1 class="text-3xl md:text-5xl font-extrabold text-white">The Ultimate Running Shoe Tier List</h1>
            <p class="text-lg text-slate-400">Ranking the best daily trainers, racers, and trail shoes based on pure performance.</p>
            
            <div class="relative max-w-lg mx-auto mt-6">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-lucide="search" class="h-5 w-5 text-slate-500"></i>
                </div>
                <input 
                    type="text" 
                    id="searchInput" 
                    class="block w-full pl-10 pr-3 py-3 border border-slate-700 rounded-full leading-5 bg-slate-800 text-white placeholder-slate-500 focus:outline-none focus:bg-slate-800 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition sm:text-sm shadow-sm"
                    placeholder="Search shoes by name, brand, or type (e.g. 'Carbon', 'Nike')..."
                    disabled
                >
            </div>
            <p id="resultCount" class="text-sm text-slate-500 h-5"></p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 md:p-8 overflow-x-hidden">
        
        <!-- Loading State -->
        <div id="loadingState" class="flex flex-col items-center justify-center py-12">
            <div class="loader mb-4"></div>
            <p class="text-slate-400 text-lg">Fetching latest rankings from Google Sheets...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden flex-col items-center justify-center py-12 text-center">
            <i data-lucide="alert-triangle" class="h-16 w-16 text-red-400 mb-4"></i>
            <h3 class="text-xl font-medium text-white">Failed to load data</h3>
            <p class="text-slate-400 max-w-md mt-2">Could not connect to the spreadsheet. Please check your internet connection or try again later.</p>
        </div>

        <div class="max-w-7xl mx-auto space-y-4 hidden" id="tierContainer">
            <!-- Tiers will be injected here via JS -->
        </div>
        
        <!-- Empty Search State -->
        <div id="noResults" class="hidden flex-col items-center justify-center py-20 text-center">
            <i data-lucide="ghost" class="h-16 w-16 text-slate-600 mb-4"></i>
            <h3 class="text-xl font-medium text-white">No shoes found</h3>
            <p class="text-slate-500">Try adjusting your search terms.</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-800 text-slate-500 py-8 text-center text-sm">
        <p class="font-medium">Powered by Github and Caffeine.</p>
    </footer>

    <!-- About Modal -->
    <div id="aboutModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-black bg-opacity-80 transition-opacity" aria-hidden="true" onclick="closeAboutModal()"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-slate-900 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full border border-slate-700">
                <div class="bg-slate-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="text-center">
                        <div class="mx-auto h-32 w-32 rounded-full overflow-hidden mb-4 border-4 border-emerald-900 shadow-md">
                             <img src="https://i.imgur.com/eXuqXli.png" alt="Profile" class="h-full w-full object-cover">
                        </div>
                        <h3 class="text-2xl leading-6 font-bold text-white">About Rank My Kicks</h3>
                        <div class="mt-4 text-left">
                            <p class="text-sm text-slate-300 leading-relaxed text-center">
                                Welcome to Rank My Kicks! This is where I document my personal experiences with various running shoes. 
                                I rank them based on performance, comfort, and value to help you find your next pair. 
                                Whether you're looking for a daily trainer or a race day super shoe, I've got opinions to share.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-800 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-slate-700">
                    <button type="button" class="w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-slate-200 hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:mt-0 sm:w-auto sm:text-sm" onclick="closeAboutModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="reviewModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-black bg-opacity-80 transition-opacity" aria-hidden="true" onclick="closeModal()"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-slate-900 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full border border-slate-700">
                <div class="bg-slate-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div id="modalIconContainer" class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-slate-800 sm:mx-0 sm:h-10 sm:w-10 text-emerald-400">
                            <!-- Icon injected here -->
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-2xl leading-6 font-bold text-white" id="modalTitle">Shoe Name</h3>
                                    <p class="text-sm text-emerald-400 font-semibold mt-1" id="modalSubtitle">Brand • Type</p>
                                </div>
                                <button onclick="shareShoe()" class="text-slate-400 hover:text-white transition p-1" title="Share this review">
                                    <i data-lucide="share-2" class="w-5 h-5"></i>
                                </button>
                            </div>
                            
                            <div class="mt-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-slate-200" id="modalTierBadge">
                                Tier S
                            </div>

                            <div class="mt-4 border-t border-slate-700 pt-4">
                                <h4 class="text-sm font-bold text-slate-400 uppercase tracking-wide">The Verdict</h4>
                                <p class="text-sm text-slate-300 mt-2 leading-relaxed" id="modalContent">
                                    Review content goes here...
                                </p>
                            </div>

                            <!-- Specs Grid -->
                            <div class="mt-4 grid grid-cols-2 gap-2 text-center">
                                <div class="bg-slate-800 p-2 rounded border border-slate-700">
                                    <span class="block text-xs text-slate-400 uppercase">Weight</span>
                                    <span class="block text-sm font-bold text-slate-200" id="modalWeight"></span>
                                </div>
                                <div class="bg-slate-800 p-2 rounded border border-slate-700">
                                    <span class="block text-xs text-slate-400 uppercase">Drop</span>
                                    <span class="block text-sm font-bold text-slate-200" id="modalDrop"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-800 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-slate-700">
                    <button type="button" class="w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-slate-200 hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:ml-3 sm:w-auto sm:text-sm" onclick="closeModal()">
                        Close
                    </button>
                    <a href="#" id="modalBuyLink" target="_blank" class="mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-200 text-base font-medium text-slate-900 hover:bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Buy Now
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. Configuration & Constants ---
        const SHEET_ID = '13-J6baHWaX6EJ1BoJKE05DbCHOJNTJrrmbuX31y6omE';
        // Note: 'Sheet1' is default, but if you renamed your tab, change it here.
        const SHEET_NAME = 'Sheet1'; 
        
        const tiers = [
            { id: 'S', label: 'S', class: 'bg-tier-s', desc: 'God Tier - The absolute best.' },
            { id: 'A', label: 'A', class: 'bg-tier-a', desc: 'Excellent - Near perfect.' },
            { id: 'B', label: 'B', class: 'bg-tier-b', desc: 'Great - Reliable daily drivers.' },
            { id: 'C', label: 'C', class: 'bg-tier-c', desc: 'Good - Has some flaws.' },
            { id: 'D', label: 'D', class: 'bg-tier-d', desc: 'Mediocre - Better options exist.' },
            { id: 'F', label: 'F', class: 'bg-tier-f', desc: 'Avoid - Painful or outdated.' },
        ];

        // --- 2. Application State ---
        let shoes = [];
        let filteredShoes = [];

        // --- 3. DOM Elements ---
        const tierContainer = document.getElementById('tierContainer');
        const searchInput = document.getElementById('searchInput');
        const resultCount = document.getElementById('resultCount');
        const noResults = document.getElementById('noResults');
        const modal = document.getElementById('reviewModal');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const toast = document.getElementById('toast');

        // --- 4. Data Processing (JSONP style) ---

        // This function will be called by the script tag we inject below
        window.handleSheetLoad = function(json) {
            try {
                // Google Sheet JSON has a specific structure: table.cols (headers) and table.rows (data)
                const rowsData = [];
                
                // Extract Headers
                // Try to find headers in the 'cols' definition first
                let headers = json.table.cols.map(c => c.label).filter(l => l !== '');
                
                // If cols have no labels (common in some exports), headers might be in the first row of data
                if (headers.length === 0 && json.table.rows.length > 0) {
                     headers = json.table.rows[0].c.map(cell => cell ? (cell.v || '') : '');
                     // If we took headers from row 0, we should skip row 0 in the data loop below, 
                     // BUT to be safe, let's just create a raw 2D array and pass it to our robust transformer
                }

                // Convert Google's complex JSON to a simple 2D Array
                // Row 0 will be headers, Row 1+ will be data
                // We construct a "Raw" 2D array to simulate a CSV read
                const rawData = [];
                
                // Add headers if they were found in 'cols'
                const colsHeaders = json.table.cols.map(c => c.label || '');
                // Check if 'cols' actually has useful headers (not just empty strings or generated ids)
                const hasColHeaders = colsHeaders.some(h => h.length > 0);
                
                if (hasColHeaders) {
                    rawData.push(colsHeaders);
                }

                // Add all rows
                json.table.rows.forEach(r => {
                    const rowVal = r.c.map(cell => cell ? (cell.v !== null ? cell.v : '') : '');
                    rawData.push(rowVal);
                });

                shoes = transformSheetData(rawData);
                
                // Remove loading, show content
                loadingState.classList.add('hidden');
                tierContainer.classList.remove('hidden');
                
                // Enable search
                searchInput.disabled = false;
                
                // Initial Render
                filteredShoes = [...shoes];
                renderTiers();

                // Check for URL param to open specific shoe
                const params = new URLSearchParams(window.location.search);
                const shoeNameParam = params.get('shoe');
                if (shoeNameParam) {
                    const targetShoe = shoes.find(s => s.name.toLowerCase() === shoeNameParam.toLowerCase());
                    if (targetShoe) {
                        openModal(targetShoe.id);
                    }
                }

            } catch (error) {
                console.error('Error processing sheet data:', error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
                errorState.classList.add('flex');
            }
        };

        function transformSheetData(rows) {
            if (rows.length < 2) return [];

            // Identify header indices (flexible matching)
            const headers = rows[0].map(h => String(h).toLowerCase());
            
            const getIndex = (keywords) => headers.findIndex(h => keywords.some(k => h.includes(k)));

            // Columns matching your specific request
            const idx = {
                name: getIndex(['shoe name']),
                brand: getIndex(['shoe brand']),
                type: getIndex(['shoe type']),
                weight: getIndex(['shoe weight']),
                drop: getIndex(['shoe drop']),
                tier: getIndex(['tier']),
                link: getIndex(['buy now link']),
                image: getIndex(['shoe image', 'image']),
                desc: getIndex(['review', 'description'])
            };

            // Map rows to objects
            return rows.slice(1).map((row, i) => {
                // Helper to safely get value
                const getVal = (index) => index !== -1 && row[index] ? String(row[index]) : '';
                
                // Fallback for missing Tier column (default to 'C' or 'Unknown')
                let tierVal = getVal(idx.tier).toUpperCase().trim();
                if (!['S','A','B','C','D','F'].includes(tierVal)) {
                    const match = tierVal.match(/[SABCDF]/);
                    tierVal = match ? match[0] : 'C'; 
                }

                return {
                    id: i, // Use row index as ID
                    name: getVal(idx.name) || "Unnamed Shoe",
                    brand: getVal(idx.brand) || "Unknown Brand",
                    type: getVal(idx.type) || "Running",
                    tier: tierVal, 
                    weight: getVal(idx.weight) || "N/A",
                    drop: getVal(idx.drop) || "N/A",
                    desc: getVal(idx.desc) || "No review available.",
                    link: getVal(idx.link) || "#",
                    image: getVal(idx.image) || ""
                };
            });
        }

        // --- 5. Render Functions ---
        
        function getIconForType(type) {
            const t = type.toLowerCase();
            if (t.includes('racer') || t.includes('speed') || t.includes('carbon')) return 'zap';
            if (t.includes('trail')) return 'mountain';
            if (t.includes('recovery') || t.includes('cushion')) return 'armchair';
            return 'activity';
        }

        function renderShoeCard(shoe) {
            const iconName = getIconForType(shoe.type);
            
            // Logic to determine if we show an image or an icon
            let visualContent;
            if (shoe.image && shoe.image.startsWith('http')) {
                visualContent = `<img src="${shoe.image}" alt="${shoe.name}" class="h-16 w-16 rounded-full object-cover border border-slate-700">`;
            } else {
                visualContent = `
                    <div class="h-16 w-16 bg-slate-700 rounded-full flex items-center justify-center text-slate-400">
                        <i data-lucide="${iconName}" class="w-8 h-8"></i>
                    </div>
                `;
            }

            return `
                <div class="card-shadow bg-slate-800 rounded-lg p-3 w-36 flex-shrink-0 cursor-pointer border border-slate-700 hover:border-emerald-500 relative group animate-fade-in"
                     onclick="openModal(${shoe.id})">
                    <div class="absolute top-2 right-2 text-slate-500 group-hover:text-emerald-500">
                        <i data-lucide="info" class="w-4 h-4"></i>
                    </div>
                    <div class="flex justify-center mb-2 mt-2">
                        ${visualContent}
                    </div>
                    <div class="text-center">
                        <h4 class="font-bold text-sm text-slate-100 leading-tight line-clamp-2 h-9">${shoe.name}</h4>
                        <p class="text-xs text-slate-400 mt-1 truncate">${shoe.brand}</p>
                    </div>
                </div>
            `;
        }

        function renderTiers() {
            tierContainer.innerHTML = '';
            let totalVisible = 0;

            tiers.forEach(tier => {
                const tierShoes = filteredShoes.filter(s => s.tier === tier.id);
                const isSearching = searchInput.value.length > 0;
                
                if (isSearching && tierShoes.length === 0) return;

                totalVisible += tierShoes.length;

                const tierRow = document.createElement('div');
                tierRow.className = "flex flex-col md:flex-row shadow-sm rounded-lg overflow-hidden border border-slate-700 bg-slate-800";
                
                const labelDiv = document.createElement('div');
                labelDiv.className = `${tier.class} md:w-32 p-4 flex flex-col items-center justify-center text-center flex-shrink-0 min-h-[120px]`;
                labelDiv.innerHTML = `
                    <span class="text-4xl font-black opacity-80">${tier.label}</span>
                    <span class="text-xs font-semibold mt-1 uppercase opacity-75 hidden md:block">${tier.desc.split('-')[0]}</span>
                `;

                const shoesDiv = document.createElement('div');
                shoesDiv.className = "flex-grow p-4 bg-slate-900 flex flex-row flex-wrap gap-4 items-center content-center tier-row overflow-x-auto";
                
                if (tierShoes.length > 0) {
                    shoesDiv.innerHTML = tierShoes.map(renderShoeCard).join('');
                } else {
                    shoesDiv.innerHTML = `<span class="text-slate-600 text-sm italic p-2">No shoes in this tier...</span>`;
                }

                tierRow.appendChild(labelDiv);
                tierRow.appendChild(shoesDiv);
                tierContainer.appendChild(tierRow);
            });

            if (totalVisible === 0 && shoes.length > 0) {
                noResults.classList.remove('hidden');
                noResults.classList.add('flex');
            } else {
                noResults.classList.add('hidden');
                noResults.classList.remove('flex');
            }
            
            lucide.createIcons();
        }

        // --- 6. Interaction Logic ---
        function handleSearch(e) {
            const query = e.target.value.toLowerCase();
            
            if (!query) {
                filteredShoes = [...shoes];
                resultCount.textContent = "";
            } else {
                filteredShoes = shoes.filter(shoe => {
                    return (shoe.name && shoe.name.toLowerCase().includes(query)) || 
                           (shoe.brand && shoe.brand.toLowerCase().includes(query)) ||
                           (shoe.type && shoe.type.toLowerCase().includes(query));
                });
                resultCount.textContent = `Found ${filteredShoes.length} shoes`;
            }
            renderTiers();
        }

        window.openModal = function(id) {
            const shoe = shoes.find(s => s.id === id);
            if (!shoe) return;

            // Update URL to make it shareable
            const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?shoe=' + encodeURIComponent(shoe.name);
            window.history.pushState({path:newUrl},'',newUrl);

            document.getElementById('modalTitle').textContent = shoe.name;
            document.getElementById('modalSubtitle').textContent = `${shoe.brand} • ${shoe.type}`;
            document.getElementById('modalContent').textContent = shoe.desc;
            document.getElementById('modalWeight').textContent = shoe.weight;
            document.getElementById('modalDrop').textContent = shoe.drop;
            
            const tierObj = tiers.find(t => t.id === shoe.tier) || { class: 'bg-tier-unknown', desc: 'Unknown' };
            const badge = document.getElementById('modalTierBadge');
            badge.textContent = `Tier ${shoe.tier} - ${tierObj.desc.split('-')[0]}`;
            // For modal badge in dark mode, we might want to keep the colored bg but ensure text is readable.
            // Or use a muted version. For now, using the colored class is fine as text contrast is hardcoded in CSS.
            badge.className = `mt-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tierObj.class}`;
            
            const iconName = getIconForType(shoe.type);
            const iconContainer = document.getElementById('modalIconContainer');
            
            if (shoe.image && shoe.image.startsWith('http')) {
                 iconContainer.innerHTML = `<img src="${shoe.image}" alt="${shoe.name}" class="h-full w-full rounded-full object-cover">`;
            } else {
                 iconContainer.innerHTML = `<i data-lucide="${iconName}" class="h-6 w-6 text-emerald-400"></i>`;
            }
            
            const buyBtn = document.getElementById('modalBuyLink');
            if (shoe.link && shoe.link.startsWith('http')) {
                buyBtn.href = shoe.link;
                buyBtn.classList.remove('opacity-50', 'pointer-events-none');
                buyBtn.textContent = 'Buy Now';
            } else {
                buyBtn.href = '#';
                buyBtn.classList.add('opacity-50', 'pointer-events-none');
                buyBtn.textContent = 'No Link Available';
            }

            lucide.createIcons();
            modal.classList.remove('hidden');
        }

        window.closeModal = function() {
            // Reset URL when closing
            const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
            window.history.pushState({path:newUrl},'',newUrl);
            modal.classList.add('hidden');
        }

        window.shareShoe = function() {
            // Since we updated the URL in openModal, we can just copy window.location.href
            navigator.clipboard.writeText(window.location.href).then(function() {
                // Show toast
                toast.classList.remove('translate-y-20', 'opacity-0');
                setTimeout(() => {
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            }, function(err) {
                console.error('Async: Could not copy text: ', err);
            });
        }
        
        // About Modal Functions
        window.openAboutModal = function() {
            document.getElementById('aboutModal').classList.remove('hidden');
        }

        window.closeAboutModal = function() {
            document.getElementById('aboutModal').classList.add('hidden');
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeModal();
                closeAboutModal();
            }
        });
        searchInput.addEventListener('input', handleSearch);

        // --- 7. Initialization (Inject Script for JSONP) ---
        function init() {
            // We use JSONP to bypass CORS
            const script = document.createElement('script');
            // 'tqx=responseHandler:handleSheetLoad' tells Google to call our function
            script.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=responseHandler:handleSheetLoad&sheet=${SHEET_NAME}`;
            script.onerror = function() {
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
                errorState.classList.add('flex');
            };
            document.body.appendChild(script);
        }

        init();

    </script>
</body>
</html>
